<html>
<head>
    <script type="text/javascript" src="http://pubnub.github.io/eon/lib/eon-map.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script> <!--jquery from Google CDN -->
    <link type="text/css" rel="stylesheet" href="http://pubnub.github.io/eon/lib/eon.css"/>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.6.4/leaflet.css"/>
    <style type="text/css">
        @import url(https://fonts.googleapis.com/css?family=Droid+Serif:700italic);
        body {
        padding-top: 40px;
        background-color: #cfcfc4;
        font-family: 'Droid Serif', serif;

        }
        #map {
        position:absolute;
        top:0;
        bottom:65%;
        width:90%;
        }
    </style>
    <title>WKWebView</title>
    <meta charset="UTF-8">
</head>
<body>
<!--Page-->
<h1>EON.js on Android</h1>
<div id="map"></div>
<script>
var lat;
var long;
var xmlData = "http://webservices.nextbus.com/service/publicXMLFeed?command=vehicleLocations&a=sf-muni&r=1&t=1144953500233";
//get data from xml link
$(document).ready(function () {
    $.get(xmlData, function (xml) {
        $('vehicle', xml).each(function (index, vehicle) {
            long = $(vehicle).attr('lng');
            lat = $(vehicle).attr('lat');
            $('#dl').append(
                $(document.createElement('dt'))
                    .append(
                        $(document.createElement('p'))
                            .text(lat + ' - ' + long)
                    )
            );
        });

    });
});
//publish
var pub_key = 'pub-c-cfd86269-b02b-4004-97a6-92ca5f582fce';
var sub_key = 'sub-c-e3dc294e-4568-11e6-bfbb-02ee2ddab7fe';
var chan = 'pubTrans';
var pb = PUBNUB.init({
  publish_key:  pub_key,
  subscribe_key: sub_key
});

setInterval(function() {
    PUBNUB.publish({
        channel: chan,
        message:
        [
            {"latlng": [lat, long]}
        ]
    });
}, 1000);

//var lat = document.querySelector("[lat=" + lat + "]");
//var long = document.querySelector("[lon=" + lon + "]");
if(window.DOMParser) {
    parser = new DOMParser();
    xmlDoc = parser.parseFromString(xmlData, "text/xml");
}
else {
    //internet explore
    xmlDoc = new ActiveXObject("Microsoft.XMLDOM");
    xmlDoc.async = false;
    xmlDoc.loadXML(xmlData);
}

//xmlDoc.getElementsByTagName("lat")[0].childNodes[0].nodeValue;

eon.map({
  id: 'map',
  mb_token: 'pk.eyJ1IjoibGl6emllcGlrYSIsImEiOiJjaXFpZWk4d2cwNjd2ZnJtMXhiaTRmbXNpIn0.N2u0leIXpKQSC6Er0YkAjg',
  mb_id: 'mapbox.streets',
  channel: chan
});
</script>
</body>
</html>